<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Erase Debt SA - Client Portal</title>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  
  <style>
    :root {
      --primary-color: #2680b3;
      --primary-dark: #1c6a97;
      --secondary-color: #3d4f58;
      --secondary-dark: #2e3c42;
      --light-color: #f8f9fa;
      --dark-color: #343a40;
      --success-color: #28a745;
      --warning-color: #ffc107;
      --danger-color: #dc3545;
      --info-color: #17a2b8;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #333;
      line-height: 1.6;
    }
    
    .header-gradient {
      background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
      color: white;
    }
    
    .hero-section {
      background-image: url('attached_assets/IMG_8999.png');
      background-size: cover;
      background-position: center;
      padding: 100px 0;
      position: relative;
    }
    
    .hero-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
    }
    
    .hero-content {
      position: relative;
      z-index: 1;
    }
    
    .btn-primary {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      background-color: var(--primary-dark);
      border-color: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .card {
      transition: all 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    
    .result-card {
      display: none;
    }
    
    .testimonial-card {
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 20px;
      position: relative;
    }
    
    .testimonial-card::before {
      content: '"';
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 60px;
      color: rgba(0, 0, 0, 0.1);
      font-family: Georgia, serif;
    }
    
    .client-info {
      display: flex;
      align-items: center;
      margin-top: 15px;
    }
    
    .client-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
      margin-right: 15px;
    }
    
    .feature-box {
      padding: 20px;
      border-radius: 10px;
      background: white;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
    }
    
    .feature-box:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    .feature-icon {
      width: 60px;
      height: 60px;
      background-color: rgba(38, 128, 179, 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
      color: var(--primary-color);
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header-gradient py-3">
    <div class="container">
      <div class="d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center">
          <img src="attached_assets/IMG_8996.jpeg" alt="Erase Debt SA Logo" class="me-3" height="40">
          <h1 class="h3 m-0">Erase Debt SA</h1>
        </div>
        <nav>
          <button class="btn btn-outline-light me-2" id="lookupTabBtn">Client Lookup</button>
          <button class="btn btn-outline-light" id="queryTabBtn">Submit Query</button>
        </nav>
      </div>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="hero-section">
    <div class="container">
      <div class="hero-content text-center text-white">
        <h1 class="display-4 fw-bold mb-4">Client Portal</h1>
        <p class="lead mb-4">Track your service progress and submit queries in one place</p>
        <div class="d-flex justify-content-center gap-3">
          <button class="btn btn-light btn-lg" id="heroLookupBtn">
            <i class="bi bi-search me-2"></i> Track Service
          </button>
          <button class="btn btn-outline-light btn-lg" id="heroQueryBtn">
            <i class="bi bi-chat-dots me-2"></i> Submit Query
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <div class="container py-5">
    <!-- Tabs -->
    <div class="mb-4">
      <ul class="nav nav-tabs">
        <li class="nav-item">
          <a class="nav-link active" id="lookup-tab" data-bs-toggle="tab" href="#lookup">Client Lookup</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="query-tab" data-bs-toggle="tab" href="#query">Submit Query</a>
        </li>
      </ul>
    </div>
    
    <div class="tab-content">
      <!-- Client Lookup Tab -->
      <div class="tab-pane fade show active" id="lookup">
        <div class="row justify-content-center">
          <div class="col-md-5 d-none d-md-block">
            <img src="client-lookup.jpg" alt="Track Your Service" class="img-fluid rounded shadow-sm mb-4" style="max-height: 400px; object-fit: cover;">
            <div class="bg-light p-4 rounded shadow-sm">
              <h4 class="h5 mb-3"><i class="bi bi-info-circle-fill text-primary me-2"></i> Why Track Your Service?</h4>
              <ul class="list-unstyled">
                <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i> Monitor your payment progress</li>
                <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i> View your service details</li>
                <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i> Check your remaining balance</li>
                <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i> Access important service documents</li>
              </ul>
            </div>
          </div>
          <div class="col-md-7">
            <div class="card shadow mb-4 border-0">
              <div class="card-header bg-white">
                <h2 class="h4 mb-0">Look Up Your Service</h2>
              </div>
              <div class="card-body">
                <p class="card-text">Enter your South African ID number to view your service details and payment history.</p>
                <form id="lookupForm">
                  <div class="mb-3">
                    <label for="idNumber" class="form-label">South African ID Number</label>
                    <div class="input-group">
                      <span class="input-group-text"><i class="bi bi-person-badge"></i></span>
                      <input type="text" class="form-control" id="idNumber" maxlength="13" pattern="[0-9]{13}" placeholder="13 digit ID number" required>
                    </div>
                    <div class="form-text">Your ID number is used to look up your service information.</div>
                  </div>
                  <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary btn-lg">
                      <i class="bi bi-search me-2"></i> Look Up Service
                    </button>
                    <button type="button" id="demoButton" class="btn btn-outline-secondary btn-sm">
                      Try Demo (Test ID: 8804015196086)
                    </button>
                  </div>
                </form>
              </div>
            </div>
            
            <!-- Error Message (hidden by default) -->
            <div id="errorMessage" class="alert alert-danger d-none" role="alert">
              <i class="bi bi-exclamation-triangle-fill me-2"></i>
              <span id="errorText"></span>
            </div>
            
            <!-- Results Section (hidden by default) -->
            <div id="resultSection" class="result-card">
              <!-- Client Header -->
              <div class="card shadow-sm mb-4">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <h3 id="clientName" class="h5 mb-1"></h3>
                      <p id="idNumberDisplay" class="text-muted small mb-0"></p>
                    </div>
                    <span id="statusBadge" class="badge"></span>
                  </div>
                </div>
              </div>
              
              <!-- Client Details -->
              <div class="card shadow-sm mb-4">
                <div class="card-body">
                  <h4 class="h5 mb-3">Service Details</h4>
                  <div class="row g-3 mb-4">
                    <div class="col-md-6">
                      <p class="mb-1"><strong>Service Type:</strong></p>
                      <p id="serviceType" class="mb-0"></p>
                    </div>
                    <div class="col-md-6">
                      <p class="mb-1"><strong>Status:</strong></p>
                      <p id="applicationStatus" class="mb-0"></p>
                    </div>
                    <div class="col-md-6">
                      <p class="mb-1"><strong>Total Fee:</strong></p>
                      <p id="totalFee" class="mb-0"></p>
                    </div>
                    <div class="col-md-6">
                      <p class="mb-1"><strong>Amount Paid:</strong></p>
                      <p id="amountPaid" class="mb-0"></p>
                    </div>
                    <div class="col-md-6">
                      <p class="mb-1"><strong>Remaining:</strong></p>
                      <p id="remainingAmount" class="mb-0"></p>
                    </div>
                  </div>
                  
                  <h4 class="h5 mb-3">Payment Progress</h4>
                  <div class="mb-4">
                    <div class="progress" style="height: 20px;">
                      <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
                    </div>
                    <p id="progressText" class="text-end mt-1 mb-0">0% complete</p>
                  </div>
                  
                  <h4 class="h5 mb-3">Payment History</h4>
                  <div id="paymentHistory" class="mb-4">
                    <!-- Payment history will be populated here -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Submit Query Tab -->
      <div class="tab-pane fade" id="query">
        <div class="row justify-content-center">
          <div class="col-md-5 d-none d-md-block">
            <img src="submit-query.jpg" alt="Submit Your Query" class="img-fluid rounded shadow-sm mb-4" style="max-height: 400px; object-fit: cover;">
            <div class="bg-light p-4 rounded shadow-sm">
              <h4 class="h5 mb-3"><i class="bi bi-chat-dots-fill text-primary me-2"></i> Our Support Promise</h4>
              <ul class="list-unstyled">
                <li class="mb-2"><i class="bi bi-clock-fill text-success me-2"></i> Quick response times</li>
                <li class="mb-2"><i class="bi bi-person-fill text-success me-2"></i> Dedicated support specialists</li>
                <li class="mb-2"><i class="bi bi-envelope-check-fill text-success me-2"></i> Email notifications at every step</li>
                <li class="mb-2"><i class="bi bi-shield-check-fill text-success me-2"></i> Secure and confidential</li>
              </ul>
            </div>
          </div>
          <div class="col-md-7">
            <div class="card shadow border-0">
              <div class="card-header bg-white">
                <h2 class="h4 mb-0">Submit Your Query</h2>
              </div>
              <div class="card-body">
                <p class="card-text mb-4">
                  Fill in the form below to submit your query. A customer service representative will contact you as soon as possible.
                  You'll receive an email with a reference number that you can use to track the progress of your query.
                </p>
                
                <form id="queryForm">
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label for="query-idNumber" class="form-label">South African ID Number*</label>
                      <input type="text" class="form-control" id="query-idNumber" name="idNumber" required maxlength="13" pattern="[0-9]{13}" placeholder="13 digit ID number">
                    </div>
                    <div class="col-md-6">
                      <label for="clientName" class="form-label">Full Name*</label>
                      <input type="text" class="form-control" id="clientName" name="clientName" required placeholder="Your full name">
                    </div>
                    <div class="col-md-6">
                      <label for="email" class="form-label">Email Address*</label>
                      <input type="email" class="form-control" id="email" name="email" required placeholder="Your email address">
                    </div>
                    <div class="col-md-6">
                      <label for="phone" class="form-label">Phone Number*</label>
                      <input type="tel" class="form-control" id="phone" name="phone" required placeholder="Your phone number">
                    </div>
                    <div class="col-12">
                      <label for="subject" class="form-label">Subject*</label>
                      <input type="text" class="form-control" id="subject" name="subject" required placeholder="Query subject">
                    </div>
                    <div class="col-12">
                      <label for="category" class="form-label">Category</label>
                      <select class="form-select" id="category" name="category">
                        <option value="general">General Inquiry</option>
                        <option value="debt_review">Debt Review</option>
                        <option value="credit_clearance">Credit Clearance</option>
                        <option value="payment">Payment Query</option>
                        <option value="technical">Technical Support</option>
                        <option value="other">Other</option>
                      </select>
                    </div>
                    <div class="col-12">
                      <label for="message" class="form-label">Message*</label>
                      <textarea class="form-control" id="message" name="message" rows="5" required placeholder="Please describe your query in detail"></textarea>
                    </div>
                    <div class="col-12">
                      <div class="form-text mb-3">* Required fields</div>
                      <div class="d-grid">
                        <button type="submit" class="btn btn-primary">
                          <i class="bi bi-send me-2"></i> Submit Query
                        </button>
                      </div>
                    </div>
                  </div>
                </form>
                
                <!-- Success Message (hidden by default) -->
                <div id="querySuccess" class="alert alert-success mt-4 d-none" role="alert">
                  <i class="bi bi-check-circle-fill me-2"></i>
                  <span>Your query has been submitted successfully. A reference number has been sent to your email.</span>
                </div>
                
                <!-- Error Message (hidden by default) -->
                <div id="queryError" class="alert alert-danger mt-4 d-none" role="alert">
                  <i class="bi bi-exclamation-triangle-fill me-2"></i>
                  <span id="queryErrorText"></span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Testimonials Section -->
    <section class="py-5 bg-light">
      <div class="container">
        <div class="text-center mb-5">
          <h2 class="fw-bold">Client Success Stories</h2>
          <p class="text-muted">See how we've helped clients like you regain their financial freedom</p>
        </div>
        
        <div class="row">
          <div class="col-md-4 mb-4">
            <div class="testimonial-card">
              <p class="mb-0">"I was stuck in debt review for years and couldn't get financing for my business. Erase Debt SA helped me clear my debt review status in just 3 months. Now I have access to credit again!"</p>
              <div class="client-info">
                <img src="attached_assets/IMG_9064.png" alt="Client" class="client-avatar">
                <div>
                  <h5 class="mb-0">Sipho M.</h5>
                  <small class="text-muted">Durban</small>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-md-4 mb-4">
            <div class="testimonial-card">
              <p class="mb-0">"I had multiple defaults on my credit record that were preventing me from buying a home. Erase Debt SA cleared all the defaults and now my credit score has improved by over 200 points!"</p>
              <div class="client-info">
                <img src="attached_assets/IMG_9068.png" alt="Client" class="client-avatar">
                <div>
                  <h5 class="mb-0">Nomsa K.</h5>
                  <small class="text-muted">Johannesburg</small>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-md-4 mb-4">
            <div class="testimonial-card">
              <p class="mb-0">"The Complete Debt Resolution service changed my life. After being blacklisted for years, I now have a clean credit record. The team was professional and kept me updated throughout the process."</p>
              <div class="client-info">
                <img src="attached_assets/IMG_9073.png" alt="Client" class="client-avatar">
                <div>
                  <h5 class="mb-0">Thabo L.</h5>
                  <small class="text-muted">Cape Town</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Features Section -->
    <section class="py-5">
      <div class="container">
        <div class="text-center mb-5">
          <h2 class="fw-bold">Why Choose Our Services</h2>
          <p class="text-muted">We offer comprehensive debt resolution solutions</p>
        </div>
        
        <div class="row g-4">
          <div class="col-md-4">
            <div class="feature-box text-center">
              <div class="feature-icon mx-auto">
                <i class="bi bi-shield-check fs-4"></i>
              </div>
              <h4 class="h5 mb-3">Debt Review Removal</h4>
              <p class="text-muted mb-0">We help you remove your debt review status through legal channels, restoring your credit worthiness.</p>
            </div>
          </div>
          
          <div class="col-md-4">
            <div class="feature-box text-center">
              <div class="feature-icon mx-auto">
                <i class="bi bi-file-earmark-check fs-4"></i>
              </div>
              <h4 class="h5 mb-3">Default Clearance</h4>
              <p class="text-muted mb-0">Clear defaults and adverse listings from your credit bureau records to improve your credit score.</p>
            </div>
          </div>
          
          <div class="col-md-4">
            <div class="feature-box text-center">
              <div class="feature-icon mx-auto">
                <i class="bi bi-graph-up-arrow fs-4"></i>
              </div>
              <h4 class="h5 mb-3">Credit Rebuilding</h4>
              <p class="text-muted mb-0">Get expert guidance on rebuilding your credit score after debt review or defaults have been cleared.</p>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Footer -->
  <footer class="bg-dark text-white py-5">
    <div class="container">
      <div class="row g-4">
        <div class="col-lg-4 col-md-6">
          <div class="d-flex align-items-center mb-3">
            <img src="attached_assets/IMG_8996.jpeg" alt="Erase Debt SA Logo" class="me-3" height="40">
            <h5 class="mb-0">Erase Debt SA</h5>
          </div>
          <p class="mb-4">Helping South Africans regain their financial freedom through expert debt resolution services.</p>
          <div class="d-flex gap-3">
            <a href="#" class="text-white"><i class="bi bi-facebook fs-5"></i></a>
            <a href="#" class="text-white"><i class="bi bi-twitter fs-5"></i></a>
            <a href="#" class="text-white"><i class="bi bi-instagram fs-5"></i></a>
            <a href="#" class="text-white"><i class="bi bi-linkedin fs-5"></i></a>
          </div>
        </div>
        
        <div class="col-lg-2 col-md-6">
          <h5 class="mb-3">Services</h5>
          <ul class="list-unstyled">
            <li class="mb-2"><a href="#" class="text-white text-decoration-none">Debt Review Removal</a></li>
            <li class="mb-2"><a href="#" class="text-white text-decoration-none">Default Clearance</a></li>
            <li class="mb-2"><a href="#" class="text-white text-decoration-none">ITC Clearance</a></li>
            <li class="mb-2"><a href="#" class="text-white text-decoration-none">Name Removal</a></li>
            <li class="mb-2"><a href="#" class="text-white text-decoration-none">Complete Resolution</a></li>
          </ul>
        </div>
        
        <div class="col-lg-2 col-md-6">
          <h5 class="mb-3">Quick Links</h5>
          <ul class="list-unstyled">
            <li class="mb-2"><a href="#" class="text-white text-decoration-none">Home</a></li>
            <li class="mb-2"><a href="#" class="text-white text-decoration-none">About Us</a></li>
            <li class="mb-2"><a href="#" class="text-white text-decoration-none">Services</a></li>
            <li class="mb-2"><a href="#" class="text-white text-decoration-none">Client Portal</a></li>
            <li class="mb-2"><a href="#" class="text-white text-decoration-none">Contact Us</a></li>
          </ul>
        </div>
        
        <div class="col-lg-4 col-md-6">
          <h5 class="mb-3">Contact Information</h5>
          <ul class="list-unstyled">
            <li class="mb-2 d-flex align-items-center">
              <i class="bi bi-geo-alt-fill me-2"></i>
              <span>Durban, South Africa</span>
            </li>
            <li class="mb-2 d-flex align-items-center">
              <i class="bi bi-envelope-fill me-2"></i>
              <span>support@erasedebtsa.net</span>
            </li>
            <li class="mb-2 d-flex align-items-center">
              <i class="bi bi-telephone-fill me-2"></i>
              <span>+27 XX XXX XXXX</span>
            </li>
            <li class="mb-2 d-flex align-items-center">
              <i class="bi bi-clock-fill me-2"></i>
              <span>Mon-Fri: 8:00 AM - 5:00 PM</span>
            </li>
          </ul>
        </div>
      </div>
      
      <div class="border-top border-secondary mt-4 pt-4 text-center">
        <p class="mb-0">&copy; 2025 Erase Debt SA. All rights reserved.</p>
        <div class="mt-2">
          <a href="#" class="text-white text-decoration-none mx-2">Terms of Service</a>
          <a href="#" class="text-white text-decoration-none mx-2">Privacy Policy</a>
          <a href="#" class="text-white text-decoration-none mx-2">Cookie Policy</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Google Sheets API URL - update this with your Google Apps Script web app URL -->
  <script>
    // Configuration
    const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/AKfycbzVrWY7RaWxMK9yJ6e0qLGN7or0JYm6Uq5QhGceLao0Js2nNk65pmvw1oYI8dLmunlodA/exec';
    const API_KEY = 'edsa-secure-myown'; // Your API key
    
    document.addEventListener('DOMContentLoaded', function() {
      // Tab navigation
      const lookupTabBtn = document.getElementById('lookupTabBtn');
      const queryTabBtn = document.getElementById('queryTabBtn');
      const lookupTab = document.getElementById('lookup-tab');
      const queryTab = document.getElementById('query-tab');
      
      if (lookupTabBtn) {
        lookupTabBtn.addEventListener('click', function() {
          lookupTab.click();
        });
      }
      
      if (queryTabBtn) {
        queryTabBtn.addEventListener('click', function() {
          queryTab.click();
        });
      }
      
      // Client lookup form
      const lookupForm = document.getElementById('lookupForm');
      const idNumberInput = document.getElementById('idNumber');
      const demoButton = document.getElementById('demoButton');
      const errorMessage = document.getElementById('errorMessage');
      const errorText = document.getElementById('errorText');
      const resultSection = document.getElementById('resultSection');
      
      // Demo button functionality
      if (demoButton && idNumberInput) {
        demoButton.addEventListener('click', function() {
          idNumberInput.value = '8804015196086';
          lookupForm.dispatchEvent(new Event('submit'));
        });
      }
      
      // Lookup form submission
      if (lookupForm) {
        lookupForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          
          const idNumber = idNumberInput.value.trim();
          
          // Validate ID number
          if (!idNumber) {
            showError('Please enter your ID number');
            return;
          }
          
          if (!/^\d{13}$/.test(idNumber)) {
            showError('South African ID number must be 13 digits');
            return;
          }
          
          // Show loading state
          const submitBtn = lookupForm.querySelector('button[type="submit"]');
          const originalBtnText = submitBtn.innerHTML;
          submitBtn.disabled = true;
          submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> Loading...';
          
          // Hide any previous error
          hideError();
          
          try {
            // Call the Google Sheets API directly (JSONP to avoid CORS issues)
            const url = `${GOOGLE_SHEETS_URL}?apiKey=${API_KEY}&action=getClient&idNumber=${idNumber}&callback=handleClientData`;
            
            // Create a script element to handle JSONP
            const script = document.createElement('script');
            script.src = url;
            document.body.appendChild(script);
            
            // Define the callback function
            window.handleClientData = function(data) {
              // Reset button state
              submitBtn.disabled = false;
              submitBtn.innerHTML = originalBtnText;
              
              // Remove the script element
              document.body.removeChild(script);
              
              if (!data.success || !data.client) {
                showError(data.message || 'Client not found. Please check your ID number and try again.');
                return;
              }
              
              // Display client data
              displayClientData(data.client);
            };
            
            // Handle errors
            script.onerror = function() {
              // Reset button state
              submitBtn.disabled = false;
              submitBtn.innerHTML = originalBtnText;
              
              showError('Failed to connect to the server. Please try again later.');
            };
          } catch (error) {
            // Reset button state
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalBtnText;
            
            console.error('Error fetching client data:', error);
            showError('An error occurred. Please try again later.');
          }
        });
      }
      
      // Query form submission
      const queryForm = document.getElementById('queryForm');
      const querySuccess = document.getElementById('querySuccess');
      const queryError = document.getElementById('queryError');
      const queryErrorText = document.getElementById('queryErrorText');
      
      if (queryForm) {
        queryForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          
          // Get form data
          const formData = {
            idNumber: document.getElementById('query-idNumber').value.trim(),
            clientName: document.getElementById('clientName').value.trim(),
            email: document.getElementById('email').value.trim(),
            phone: document.getElementById('phone').value.trim(),
            subject: document.getElementById('subject').value.trim(),
            message: document.getElementById('message').value.trim(),
            category: document.getElementById('category').value
          };
          
          // Validate required fields
          if (!formData.idNumber || !formData.clientName || !formData.email || !formData.subject || !formData.message) {
            showQueryError('Please fill in all required fields');
            return;
          }
          
          // Validate ID number
          if (!/^\d{13}$/.test(formData.idNumber)) {
            showQueryError('South African ID number must be 13 digits');
            return;
          }
          
          // Show loading state
          const submitBtn = queryForm.querySelector('button[type="submit"]');
          const originalBtnText = submitBtn.innerHTML;
          submitBtn.disabled = true;
          submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> Submitting...';
          
          // Hide any previous messages
          hideQueryMessages();
          
          // For this demo, we'll directly call the Google Sheets API to simulate saving the query
          // In a real implementation, you would post to your server API endpoint
          const url = `${GOOGLE_SHEETS_URL}?apiKey=${API_KEY}&action=submitQuery&callback=handleQuerySubmit`;
          
          // Create a script element to handle JSONP
          const script = document.createElement('script');
          script.src = url;
          document.body.appendChild(script);
          
          // Define the callback function
          window.handleQuerySubmit = function(data) {
            // Reset button state
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalBtnText;
            
            // Remove the script element
            document.body.removeChild(script);
            
            if (!data.success) {
              showQueryError(data.message || 'Failed to submit query. Please try again later.');
              return;
            }
            
            // Show success message
            showQuerySuccess();
            
            // Reset form
            queryForm.reset();
          };
          
          // Handle errors
          script.onerror = function() {
            // Reset button state
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalBtnText;
            
            showQueryError('Failed to connect to the server. Please try again later.');
          };
        });
      }
      
      // Helper function to show error
      function showError(message) {
        if (errorMessage && errorText) {
          errorText.textContent = message;
          errorMessage.classList.remove('d-none');
        }
        
        if (resultSection) {
          resultSection.style.display = 'none';
        }
      }
      
      // Helper function to hide error
      function hideError() {
        if (errorMessage) {
          errorMessage.classList.add('d-none');
        }
      }
      
      // Helper function to show query error
      function showQueryError(message) {
        if (queryError && queryErrorText) {
          queryErrorText.textContent = message;
          queryError.classList.remove('d-none');
        }
        
        if (querySuccess) {
          querySuccess.classList.add('d-none');
        }
      }
      
      // Helper function to show query success
      function showQuerySuccess() {
        if (querySuccess) {
          querySuccess.classList.remove('d-none');
        }
        
        if (queryError) {
          queryError.classList.add('d-none');
        }
      }
      
      // Helper function to hide query messages
      function hideQueryMessages() {
        if (querySuccess) {
          querySuccess.classList.add('d-none');
        }
        
        if (queryError) {
          queryError.classList.add('d-none');
        }
      }
      
      // Helper function to display client data
      function displayClientData(client) {
        if (!client) return;
        
        // Set client info
        document.getElementById('clientName').textContent = client.fullName;
        document.getElementById('idNumberDisplay').textContent = `ID: ${client.idNumber}`;
        
        // Set status badge
        const statusBadge = document.getElementById('statusBadge');
        statusBadge.textContent = client.applicationStatus;
        
        // Set badge color based on status
        statusBadge.className = 'badge';
        if (client.applicationStatus === 'Active') {
          statusBadge.classList.add('bg-success');
        } else if (client.applicationStatus === 'Paused') {
          statusBadge.classList.add('bg-warning', 'text-dark');
        } else if (client.applicationStatus === 'Completed') {
          statusBadge.classList.add('bg-info');
        } else {
          statusBadge.classList.add('bg-secondary');
        }
        
        // Set service details
        document.getElementById('serviceType').textContent = client.serviceName || `SERVICE ${client.serviceType}`;
        document.getElementById('applicationStatus').textContent = client.applicationStatus;
        document.getElementById('totalFee').textContent = `R${client.totalServiceFee}`;
        document.getElementById('amountPaid').textContent = `R${client.totalPaid || 0}`;
        document.getElementById('remainingAmount').textContent = `R${client.remainingAmount || client.totalServiceFee}`;
        
        // Set progress bar
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const progress = client.progress || 0;
        
        progressBar.style.width = `${progress}%`;
        progressBar.setAttribute('aria-valuenow', progress);
        progressText.textContent = `${progress}% complete`;
        
        // Set payment history
        const paymentHistory = document.getElementById('paymentHistory');
        paymentHistory.innerHTML = '';
        
        if (client.payments && client.payments.length > 0) {
          const table = document.createElement('table');
          table.className = 'table table-striped';
          
          const thead = document.createElement('thead');
          thead.innerHTML = `
            <tr>
              <th>Payment</th>
              <th>Status</th>
            </tr>
          `;
          
          const tbody = document.createElement('tbody');
          
          client.payments.forEach((payment, index) => {
            const tr = document.createElement('tr');
            
            const tdPayment = document.createElement('td');
            tdPayment.textContent = `Payment ${index + 1}`;
            
            const tdStatus = document.createElement('td');
            
            if (payment === null) {
              const badge = document.createElement('span');
              badge.className = 'badge bg-secondary';
              badge.textContent = 'Not due yet';
              tdStatus.appendChild(badge);
            } else if (payment === 0) {
              const badge = document.createElement('span');
              badge.className = 'badge bg-danger';
              badge.textContent = 'Failed';
              tdStatus.appendChild(badge);
            } else {
              const badge = document.createElement('span');
              badge.className = 'badge bg-success';
              badge.textContent = `R${payment}`;
              tdStatus.appendChild(badge);
            }
            
            tr.appendChild(tdPayment);
            tr.appendChild(tdStatus);
            tbody.appendChild(tr);
          });
          
          table.appendChild(thead);
          table.appendChild(tbody);
          paymentHistory.appendChild(table);
        } else {
          paymentHistory.innerHTML = '<p class="text-muted">No payment history available</p>';
        }
        
        // Show result section
        resultSection.style.display = 'block';
      }
    });
  </script>
</body>
</html>